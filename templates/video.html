{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
{% endblock %}

{% block css %}

:root {
    --plyr-color-main: #FF9900; /* Pornhub orange */
  }

  .plyr--video {
    border-radius: 12px;
    overflow: hidden;
  }

  .plyrcontrols buttn {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    padding: 0;
  }

  .plyr__controls svg {
    width: 20px;
    height: 20px;
  }

.video-wrapper {
width: 100%;
max-width: 100%;
height: 450px;
margin: auto;
position: relative;
}

/* Medium screens and up (e.g., tablets) */
@media (min-width: 768px) {
.video-wrapper {
  height: auto;
}
}

/* Large screens and up (e.g., desktops) */
@media (min-width: 1024px) {
.video-wrapper {
  height: auto;
}
}

/* Extra large screens */
@media (min-width: 1280px) {
.video-wrapper {
  height: 550px;
}
}

 
 .plyr {
   height: 100% !important;
 }
 
 video {
   height: 100% !important;
   width: 100%;
   object-fit: contain;
 }
{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-6">
  <div class="flex flex-col lg:flex-col gap-6">

    <!-- Video Player -->
    <div class="video-wrapper">
      <video id="player" playsinline controls poster="{{ video.poster_url }}">
        <source src="{{ video.video_url }}" type="video/mp4" />
      </video>
    </div>

    <!-- Video Info -->
    <div class="mt-4">
      <h1 class="text-xl md:text-2xl font-bold">{{ video.title }}</h1>
      <div class="flex items-center justify-between mt-4">
        <div class="flex items-center">
          <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center">
            <i data-lucide="user" class="w-6 h-6 text-dark"></i>
          </div>
          <div class="ml-3">
            <p class="font-medium">@{{ video.creator.username }}</p>
            <p class="text-sm text-gray-400">{{ video.creator.profile.followers_count }} followers</p>
          </div>
        </div>
        <button class="px-4 py-2 bg-primary text-dark rounded-full text-sm font-medium hover:bg-secondary transition-colors">
          Follow
        </button>
      </div>
    </div>

    <!-- Video Stats -->
    <div class="flex flex-wrap items-center justify-between mt-6 pb-6 border-b border-dark-light">
      <div class="flex items-center gap-2 text-sm text-gray-400">
        <span class="flex items-center">
          <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
          {{ video.views }} views
        </span>
        <span class="flex items-center">
          <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
          Posted {{ video.created_at|timesince }} ago
        </span>
      </div>
      <!-- Action Buttons -->
      <div class="flex items-center gap-4 mt-4 sm:mt-0">
        <button class="flex items-center gap-1 hover:text-primary">
          <i data-lucide="heart" class="w-5 h-5"></i><span>Like</span>
        </button>
        <!-- Other buttons -->
      </div>
    </div>

    <!-- Description -->
    <div class="py-6 border-b border-dark-light">
      <div class="bg-dark-lighter p-4 rounded-lg">
        <p class="text-gray-300">{{ video.description|linebreaksbr }}</p>
        <!-- Optional: hashtags -->
      </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section mt-6">
      <h3 class="text-lg font-bold">Comments</h3>
      {% if comments %}
        <ul class="space-y-4 mt-4">
          {% for comment in comments %}
          <li class="border-b border-dark-light pb-4">
            <div class="flex items-center space-x-3">
              <img src="{{ comment.profile.user.profile_picture.url }}" alt="Profile" class="w-10 h-10 rounded-full">
              <div class="text-sm">
                <p class="font-medium">{{ comment.profile.user.username }}</p>
                <p class="text-gray-400">{{ comment.created_at|timesince }} ago</p>
              </div>
            </div>
            <p class="mt-2">{{ comment.content }}</p>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500">No comments yet.</p>
      {% endif %}
    </div>

    <!-- Related Videos Section -->
    <div class="up-next-videos mt-6">
      <h3 class="text-lg font-bold">Up Next</h3>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">
        {% for up_video in up_next_videos %}
        <div class="video-item">
          <a href="{% url 'video_get' slug=up_video.slug %}">
            <img src="{{ up_video.poster_url }}" alt="{{ up_video.title }}" class="w-full rounded-lg">
            <div class="mt-2">
              <p class="font-medium">{{ up_video.title }}</p>
              <p class="text-sm text-gray-400">{{ up_video.views }} views</p>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    
  </div>
</div>


  {% block js %}

  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

  <!-- Google IMA SDK for VAST Ads -->
  
  <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
  
  
  <script>
 
 const player = new Plyr('#player');
  
  // --- VAST Ad Setup ---
  const adDisplayContainer = new google.ima.AdDisplayContainer(
    document.querySelector('.plyr__video-wrapper'),
    player.media
  );
  
  const adsLoader = new google.ima.AdsLoader(adDisplayContainer);
  const adsRequest = new google.ima.AdsRequest();
  
  adsRequest.adTagUrl = 'https://vast.yomeno.xyz/vast?spot_id='; // Replace with real VAST tag 1425335
  
  adsLoader.addEventListener(
    google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
    (adsManagerLoadedEvent) => {
      const adsManager = adsManagerLoadedEvent.getAdsManager(player.media);
      adsManager.init(600, 450, google.ima.ViewMode.NORMAL);
      adsManager.start();
    }
  );
  
  player.on('play', () => {
    adDisplayContainer.initialize();
    adsLoader.requestAds(adsRequest);
  });
  
  </script>
  {% endblock %}
{% endblock %}